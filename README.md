# Swagger generated server

Spring Boot Server

## Development

Run IgeServer.java as Java Application.

With the following command a jar is generated, which contains the whole server: 
TBD: create an installer instead

> mvn clean package

If you want to use the OrientDB-Studio, then copy the zip-File "orientdb-studio-\<version\>.zip" into the plugins-directory. Afterwards it is available under the port 2480.

For the apache configuration use the following settings:

```
location /ige-server/ {
    add_header 'Access-Control-Allow-Origin' *;
    add_header 'Access-Control-Allow-Credentials' 'true';
    add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT,DELETE, OPTIONS';
    add_header 'Access-Control-Allow-Headers' 'Accept,Authorization,Cache-Control,Content-Type,DNT,If-Modified-Since,Keep-Alive,Origin,User-Agent,X-Mx-ReqToken,X-Requested-With';
    proxy_pass http://192.168.0.238:8111/;
}

location /orientdb-studio/ {
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://192.168.0.238:2480/;
}
```

To get the swagger-api json documentation go to http://localhost:8081/v1/api-docs. The UI version can be accessed with http://localhost:8081/v1, where you also can test the API.

### OrientDB Studio

Copy the zip file from the distribution (e.g. https://s3.us-east-2.amazonaws.com/orientdb3/releases/3.0.2/orientdb-3.0.2.tar.gz) and put it into the plugins directory.
After a restart of the server the Studio should be available under http://localhost:2480.

If this does not work, check the logs for a correct link. Otherwise unpack the zip-file into "src/site" (everything under www).
It's possible that the database cannot be found because there're wrong api calls. Open main.js file and search for "/api/" and replace it with "/".

## Overview  
This server was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project.  
By using the [OpenAPI-Spec](https://github.com/swagger-api/swagger-core), you can easily generate a server stub.  
This is an example of building a swagger-enabled server in Java using the SpringBoot framework.  

The underlying library integrating swagger to SpringBoot is [springfox](https://github.com/springfox/springfox)  

Start your server as an simple java application  

You can view the api documentation in swagger-ui by pointing to  
http://localhost:8080/  

Change default port value in application.properties

# FAQ

## Error after login: ERR_TOO_MANY_REDIRECTS

Check if the keycloak.credentials.secret is correct. The logs should tell if the secret is not correct and show a message "Failed to turn code into token"

## Still having the error: ERR_TOO_MANY_REDIRECTS

Another problem occurs when running Keycloak and Application in a docker container on your local machine. Then it's important that the access to the keycloak instance is the same for the backend as in the frontend in the browser, which happens actually on the local machine (not inside docker). Therefore you need to configure "/etc/hosts" file or under windows "c:\Windows\System32\Drivers\etc\hosts" and add the following entry:

> 127.0.0.1 keycloak

In your docker-compose file you would then use for your app the environment variable "KEYCLOAK_URL=http://keycloak:8080/auth" to access keycloak in the container. Moreover make sure the port mapping is the same "8080:8080" otherwise keycloak won't be able to map correctly. 
