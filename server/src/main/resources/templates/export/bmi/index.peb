{# @pebvariable name="model" type="de.ingrid.igeserver.profiles.bmi.exporter.model.BmiModel" #}
{# @pebvariable name="catalogId" type="String" #}

{
    "uuid": "{{ model.uuid }}",
    "title": "{{ model.title.trim() }}",
    "description": "{{ model.data.description }}",
    "theme": [
      "{{ model.getThemes() | join('","') | raw }}"
    ],
    "issued": "{{ model.created }}",
    "modified": "{{ model.modified }}",
    {% if model.periodicity %}
        "accrual_periodicity": "{{ model.periodicity }}",
    {% endif %}
    "contact_point": null,
    "keywords": [
        {% if not model.data.keywords.isEmpty() %}
            "{{ model.data.keywords | join('","') | raw }}"
        {% endif %}
    ],
    "creator": null,
    {% if model.data.origin %}
        "originator": [
            {
                "organization": "{{ model.data.origin }}"
            }
        ],
    {% endif %}
    "publisher": {
        "organization": "{{ model.getPublisher().organization.trim() }}",
        "homepage": "{{ model.getPublisher().getHomepage() }}"
    },
    {% if model.data.accessRights %}
        "access_rights": ["{{ model.data.accessRights }}"],
    {% endif %}
    "distribution": [
    {% for download in model.data.distributions %}
        {
            "format": ["{{ download.format.key }}"],
            {% if download.link.asLink %}
                "accessURL": "{{ download.link.value }}",
            {% else %}
                "accessURL": "/downloads/{{ model.uuid }}/{{ download.link.value }}",
            {% endif %}
            "title": "{{ download.title }}"
        }{% if not loop.last %},{% endif %}
    {% endfor %}
    ],
    "extras": {
        "metadata": {
            "issued": "{{ model.created }}",
            "modified": "{{ model.modified }}"
        },
        "license": "{{ model.getLicenseData().id }}",
        "spatial":
        {% if model.realSpatials is empty %}
        null
        {% else %}
            {% if not model.hasSingleSpatial %}
            {
                "type": "geometrycollection",
                "geometries": [
            {% endif %}
                {% for spatial in model.realSpatials %}
                    {
                        "type": "{{ spatial.getGeoType }}",
                        "coordinates": {{ spatial.getPolygon }}
                    }{% if not loop.last %},{% endif %}
                {% endfor %}
            {% if not model.hasSingleSpatial %}
                ]
            }
            {% endif %}
        {% endif %}
        ,
       {% if not model.spatialTitels.isEmpty() %}
            "spatial_text": "{{ model.spatialTitels | join(',') }}",
        {% endif %}
        "temporal": [
         {% if model.data.temporal.start or model.data.temporal.end %}
        {
            {% if model.data.temporal.start %}
                "gte": "{{model.data.temporal.start}}"{% if model.data.temporal.end %},{% endif %}
            {% endif %}
            {% if model.data.temporal.end %}
                "lte": "{{model.data.temporal.end}}"
            {% endif %}
            }
         {% endif %}],
        "citation": null
    }
}
