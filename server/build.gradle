/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'base'
    id 'java'
    id 'idea'
    id 'org.springframework.boot' version '2.2.5.RELEASE'
    id 'io.spring.dependency-management' version '1.0.9.RELEASE'
    id 'maven-publish'
    id 'com.google.cloud.tools.jib' version '2.1.0'
}

repositories {
    maven {
        url = 'https://nexus.informationgrid.eu/repository/maven-public'
    }
}

sourceSets {
    main {
        resources {
            srcDirs= ["src/develop/resources", "src/main/resources"]
        }
    }
}

configurations {
    developmentOnly
    runtimeClasspath {
        extendsFrom developmentOnly
    }
}

/*configurations {
    implementation {
        exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    }
}*/

dependencies {
    compile project(':api')
    runtimeOnly project(':frontend')
    implementation('org.springframework.boot:spring-boot-starter-web') {
        exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    }
    compile "io.pebbletemplates:pebble-spring-boot-starter:3.1.2"
    implementation 'org.springframework.boot:spring-boot-starter-tomcat'
    implementation('org.springframework.boot:spring-boot-starter-security') {
        exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    }
    compile('org.keycloak:keycloak-spring-boot-starter:9.0.0') {
        exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    }
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    compile 'org.springframework.boot:spring-boot-starter-log4j2'
    compile 'com.auth0:java-jwt:3.8.3'
    compile('org.springframework.boot:spring-boot-starter-actuator') {
        exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    }
    compile 'org.springdoc:springdoc-openapi-ui:1.2.32'
    compile 'com.orientechnologies:orientdb-core:3.0.28'
    compile 'com.orientechnologies:orientdb-server:3.0.28'
    compile 'com.github.fge:json-schema-validator:2.2.6'
    compile('de.ingrid:ingrid-codelist-service:5.2.0') {
        exclude group: 'log4j', module: 'log4j'
    }
    compile 'com.fasterxml.jackson.dataformat:jackson-dataformat-xml:2.10.2'
    compile 'javax.validation:validation-api:2.0.1.Final'
    compile 'org.apache.logging.log4j:log4j-1.2-api:2.13.0'
    compile 'org.apache.commons:commons-lang3:3.9'
    testCompile 'junit:junit'
    testCompile 'org.mockito:mockito-core'
}

group = 'de.ingrid'
description = 'IGE-NG Server'
sourceCompatibility = '11.0'

test {
    ignoreFailures = true
}

publishing {
    publications {
        maven(MavenPublication) {
            from(components.java)
        }
    }
}


// create docker image
jib {
    from {
        image = 'openjdk:11-jre-slim'
    }
    to {
        image = 'docker-registry.wemove.com/ingrid-ige-ng'
        // tags = ['jib'] // additional tags
    }
    container {
        creationTime = 'USE_CURRENT_TIMESTAMP'
        jvmFlags = ['-Xmx512m','-Dstorage.diskCache.bufferSize=256']
    }
}

//tasks.assemble.dependsOn tasks.jibDockerBuild
tasks.assemble.dependsOn tasks.jib

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}
