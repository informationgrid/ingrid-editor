<!-- Toolbar -->
<form-toolbar></form-toolbar>

<!-- Notification -->
<div class="notifyWrapper" [class.active]="saving">
    <div class="tn-box tn-box-color-1">
        <p>This form has been saved successfully!</p>
        <div class="tn-progress"></div>
    </div>
</div>
<div class="notifyWrapper" [class.active]="error">
    <div class="tn-box tn-box-color-1">
        <p>An error occured: {{error}}</p>
        <div class="tn-progress"></div>
    </div>
</div>

<div class="splitWrapper">
    <!-- exchangable sidebar -->
    <div id="sidebar" class="split split-horizontal">
        <!--<sidebar></sidebar>-->
        <tree></tree>
    </div>

    <!-- The form -->
    <div id="form" class="split split-horizontal formWrapper">
        <form *ngIf="form" (ngSubmit)="onSubmit()" [formGroup]="form">

            <!-- RENDER ALL FIELDS -->
            <div *ngFor="let field of fields" class="fieldContainer {{field.domClass}}"
                 [ngClass]="{hasChildren: field.children, padding: !field.children || field.isRepeatable}">

                <!-- SIMPLE FIELD -->
                <dyn-field *ngIf="!field.children" [field]="field" [form]="form" [value]="data"
                           (onAddSection)="addSection($event)"></dyn-field>

                <!-- COMPLEX FIELD -->
                <fieldset *ngIf="field.children">

                    <!-- CONTAINER FOR NESTED FIELDS -->
                    <div *ngIf="!field.isRepeatable">
                        <div [formGroupName]="field.key">
                            <dyn-field *ngFor="let child of field.children" [field]="child"
                                       [form]="form.controls[field.key]" [value]="data[field.key]"
                                       class="padding {{child.domClass}}">
                            </dyn-field>
                        </div>
                    </div>

                    <!-- REPEATABLE FIELDS -->
                    <div *ngIf="field.isRepeatable">
                        <div [formArrayName]="field.key">
                            <!-- render data -->
                            <div *ngFor="let child of field.children; let i=index" class="panel panel-default">
                                <div *ngIf="child.children" class="panel-heading"
                                     (click)="expandedField[child.key + i] = !expandedField[child.key + i]">
                                    <span class="fa" [class.fa-caret-down]="expandedField[child.key + i]"
                                      [class.fa-caret-right]="!expandedField[child.key + i]"></span>
                                    <span class="title">{{i+1}}. {{child.label}}</span>
                                    <button class="close pull-right"
                                            (click)="removeArrayGroup(field.key, i)">
                                            <!--*ngIf="form.controls[field.key].controls.length > 1"-->
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div [formGroupName]="i" class="panel-body" [class.hide]="!expandedField[child.key + i]">
                                    <dyn-field *ngFor="let subChild of child.children" [field]="subChild"
                                               [form]="form.controls[field.key].controls[i].controls[child.key]"
                                               [value]="data[field.key][i][child.key]"
                                               class="padding {{subChild.domClass}}">
                                    </dyn-field>
                                </div>
                            </div>

                            <!-- render generator button -->
                            <!--<dyn-field [field]="field" [form]="form" [value]="data"
                                       (onAddSection)="addSection($event)"></dyn-field>-->
                            <partial-generator [field]="field" [form]="form" (onAddSection)="addSection($event)"></partial-generator>

                        </div>
                        <!--<dyn-field *ngFor="let child of field.children" [field]="child"
                                   [form]="form.controls[field.useGroupKey]" [value]="data[field.useGroupKey]"
                                   class="padding {{child.domClass}}">
                        </dyn-field>-->
                        <!--<div *ngFor="let groups of field.children; let i=index" [formGroupName]="i"
                             class="panel panel-default">
                            <div class="panel-heading" (click)="expandedField[field.useGroupKey + i] = !expandedField[field.useGroupKey + i]">
                                <span class="fa" [class.fa-caret-down]="expandedField[field.useGroupKey + i]"
                                      [class.fa-caret-right]="!expandedField[field.useGroupKey + i]"></span>
                                <span class="title">{{i+1}}. {{field.label}}</span>
                                <button class="close pull-right" aria-label="Close"
                                        *ngIf="form.controls[field.useGroupKey].controls.length > 1"
                                        (click)="removeArrayGroup(field.useGroupKey, i)"><span
                                        aria-hidden="true">&times;</span></button>
                            </div>
                            <div class="panel-body" [class.hide]="!expandedField[field.useGroupKey + i]">
                                <dyn-field *ngFor="let child of groups" [field]="child"
                                           [form]="form.controls[field.useGroupKey].controls[i]"
                                           [value]="data[field.useGroupKey] ? data[field.useGroupKey][i] : {}"
                                           class="padding {{child.domClass}}">
                                </dyn-field>
                            </div>
                        </div>
                    </div>
                    <button (click)="addArrayGroup(field.useGroupKey)" type="button"
                            class="pull-right btn btn-default">Hinzufügen
                    </button>-->
                    </div>
                </fieldset>

            </div>


            <strong>Form contains the following values</strong><br>{{form.value | json}}
            <p>Form is valid: {{form.valid}}</p>
        </form>


    </div>
</div>

<modal #newDocModal title="Neues Dokument" submitButtonLabel="Neues Dokument" (onSubmit)="prepareNewDoc()">
    <modal-content>
        <div class="radio" *ngFor="let type of formularService.docTypes">
            <label>
                <input name="newDocChoice" type="radio" [(ngModel)]="choiceNewDoc" [value]="type.id"> {{type.label}}
            </label>
        </div>
    </modal-content>
</modal>

<modal #deleteConfirmModal title="Löschen" cancelButtonLabel="Nein" submitButtonLabel="Ja" (onSubmit)="doDelete()">
    <modal-content>
        <p>Möchten Sie wirklich diesen Datensatz löschen?</p>
    </modal-content>
</modal>

