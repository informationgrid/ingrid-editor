/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
  id 'base'
  id "com.github.node-gradle.node" version "2.2.3"
}

repositories {
  maven {
    url = 'https://nexus.informationgrid.eu/repository/maven-public'
  }
}

group = 'de.ingrid'
description = 'IGE-NG Frontend'

node {
  version = '10.16.0'
  download = true
}

task bundle(type: YarnTask) {
  //inputs.files(fileTree('node_modules'))
  inputs.files(fileTree('src'))
  inputs.file('package.json')

  outputs.dir('build/dist')

  dependsOn yarn_install
  args = ['run', 'prod']
}

task test(type: YarnTask) {
  args = ['run', 'test-headless']
}

task packageNpmApp(type: Zip) {
  dependsOn bundle
  baseName 'ige-frontend-app'
  extension 'jar'
  destinationDir file("${projectDir}/build/packageApp")
  from('build/dist') {
    // optional path under which output will be visible in Java classpath, e.g. static resources path
    into 'static'
  }
  from ('src/assets') {
    into 'static/assets'
    include 'config.prod.json'
    rename { 'config.json' }
  }
}

configurations {
  npmResources
}
configurations.default.extendsFrom(configurations.npmResources)

artifacts {
  npmResources(packageNpmApp.archivePath) {
    builtBy packageNpmApp
    type "jar"
  }
}

clean {
  // do nothing to improve speed
  // delete packageNpmApp.archivePath
}

assemble.dependsOn packageNpmApp
