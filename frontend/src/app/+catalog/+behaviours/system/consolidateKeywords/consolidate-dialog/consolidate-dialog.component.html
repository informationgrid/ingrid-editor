<div cdkDrag cdkDragRootElement=".cdk-overlay-pane">
    <!-- dialog header -->
    <div
        cdkDragHandle
        class="dialog-title-wrapper flex-row align-items-center gap-12"
    >
        <button mat-icon-button mat-dialog-close>
            <mat-icon>close</mat-icon>
        </button>
        <h1 mat-dialog-title>Schlagworte konsolidieren</h1>
    </div>

    <mat-dialog-content>
        @if (this.hasKeywords) {
            <div *ngIf="!isLoading">
                <div class="no-selection-text">
                    Bestehende Schlagworte werden hier auf ihre Aktualität
                    geprüft. Grün hinterlegte Schlagworte werden der Liste
                    hinzugefügt. Rot hinterlegte Schlagworte werden entfernt.
                </div>
                @if (isInspireIdentified && inspireTopicsNew.length) {
                    <div class="keyword-section" aria-label="INSPIRE Themen">
                        <div class="label-wrapper">
                            <label>INSPIRE Themen</label>
                        </div>
                        <mat-chip-listbox class="chip-list">
                            <mat-chip
                                *ngFor="let keyword of inspireTopicsNew"
                                [ngClass]="{
                                    'added-keyword': keyword.status === 'added',
                                    'removed-keyword':
                                        keyword.status === 'removed'
                                }"
                                [aria-label]="keyword.label"
                            >
                                {{ keyword.label }}
                            </mat-chip>
                        </mat-chip-listbox>
                    </div>
                }
                @if (isInspireIdentified && isoCategoriesNew.length) {
                    <div
                        class="keyword-section"
                        aria-label="ISO-Themenkategorie"
                    >
                        <div class="label-wrapper">
                            <label>ISO-Themenkategorie</label>
                        </div>
                        <mat-chip-listbox class="chip-list">
                            <mat-chip
                                *ngFor="let keyword of isoCategoriesNew"
                                [ngClass]="{
                                    'added-keyword': keyword.status === 'added',
                                    'removed-keyword':
                                        keyword.status === 'removed'
                                }"
                                [aria-label]="keyword.label"
                            >
                                {{ keyword.label }}
                            </mat-chip>
                        </mat-chip-listbox>
                    </div>
                }
                @if (gemetKeywordsNew.length) {
                    <div class="keyword-section" aria-label="Gemet Schlagworte">
                        <div class="label-wrapper">
                            <label>Gemet Schlagworte</label>
                        </div>
                        <mat-chip-listbox class="chip-list">
                            <mat-chip
                                *ngFor="let keyword of gemetKeywordsNew"
                                [ngClass]="{
                                    'added-keyword': keyword.status === 'added',
                                    'removed-keyword':
                                        keyword.status === 'removed'
                                }"
                                [aria-label]="keyword.label"
                            >
                                {{ keyword.label }}
                            </mat-chip>
                        </mat-chip-listbox>
                    </div>
                }
                @if (umthesKeywordsNew.length) {
                    <div
                        class="keyword-section"
                        aria-label="Umthes Schlagworte"
                    >
                        <div class="label-wrapper">
                            <label>Umthes Schlagworte</label>
                        </div>

                        <mat-chip-listbox class="chip-list">
                            <mat-chip
                                *ngFor="let keyword of umthesKeywordsNew"
                                [ngClass]="{
                                    'added-keyword': keyword.status === 'added',
                                    'removed-keyword':
                                        keyword.status === 'removed'
                                }"
                            >
                                {{ keyword.label }}
                            </mat-chip>
                        </mat-chip-listbox>
                    </div>
                }
                @if (freeKeywordsNew.length) {
                    <div class="keyword-section" aria-label="Freie Schlagworte">
                        <div class="label-wrapper">
                            <label>Freie Schlagworte</label>
                        </div>
                        <mat-chip-listbox class="chip-list">
                            <mat-chip
                                *ngFor="let keyword of freeKeywordsNew"
                                [ngClass]="{
                                    'added-keyword': keyword.status === 'added',
                                    'removed-keyword':
                                        keyword.status === 'removed'
                                }"
                            >
                                {{ keyword.label }}
                            </mat-chip>
                        </mat-chip-listbox>
                    </div>
                }
            </div>

            <div *ngIf="isLoading" class="loading-wrapper">
                <mat-spinner
                    class="content-spinner"
                    diameter="40"
                ></mat-spinner>
            </div>
            <div class="help flex-row align-items-center">
                <mat-icon svgIcon="info-24px"></mat-icon>
                <div class="legend" *ngIf="!isLoading">
                    Klicken sie auf "Übernehmen" um die Änderungen zu speichern.
                </div>
                <div class="legend" *ngIf="isLoading">
                    Schlagworte werden analysiert...
                </div>
            </div>
        } @else {
            <div class="no-selection-text">
                Zurzeit sind keine Schlagworte vorhanden.
            </div>
            <div class="help flex-row align-items-center">
                <mat-icon svgIcon="info-24px"></mat-icon>
                <div class="legend">
                    Bitte fügen Sie Schlagworte hinzu, um diese zu
                    konsolidieren.
                </div>
            </div>
        }
    </mat-dialog-content>

    <!-- dialog action buttons -->
    <mat-dialog-actions>
        <button mat-flat-button mat-dialog-close="true">Schließen</button>
        <div class="flex-1"></div>
        <button
            color="primary"
            mat-flat-button
            data-cy="save-btn"
            id="save-btn"
            [disabled]="isLoading || saveButtonClicked"
            *ngIf="this.hasKeywords"
            (click)="saveConsolidatedKeywords(); saveButtonClicked = true"
        >
            <span *ngIf="!saveButtonClicked">Übernehmen</span>
            <mat-spinner
                *ngIf="saveButtonClicked"
                class="button-spinner"
                diameter="20"
            ></mat-spinner>
        </button>
    </mat-dialog-actions>
</div>
