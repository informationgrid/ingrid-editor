<page-template label="Indizierung">

    <ng-container left-side>
        <div>Hier wird festgelegt in welchen Zeitabständen der Katalog indiziert werden soll. Für die Definition des
            Intervalls wird der Cron Ausdruck verwendet.
        </div>
        <p>Ein Cron Ausdruck ist folgendermaßen aufgebaut:</p>

        <div class="cron-explain">
            <div>
                <div class="explain">Sekunde</div>
                <div class="star">*</div>
            </div>
            <div>
                <div class="explain">Minute</div>
                <div class="star">*</div>
            </div>
            <div>
                <div class="explain">Stunde</div>
                <div class="star">*</div>
            </div>
            <div>
                <div class="explain">Tag des Monats</div>
                <div class="star">*</div>
            </div>
            <div>
                <div class="explain">Monat</div>
                <div class="star">*</div>
            </div>
            <div>
                <div class="explain">Tag der Woche</div>
                <div class="star">*</div>
            </div>
        </div>

        <div>
            Beispiele:
            <mat-chip-list>
                <mat-chip (click)="cronField.setValue('0 */10 * * * *')">Alle 10 Minuten</mat-chip>
                <mat-chip (click)="cronField.setValue('0 0 3 * * *')">Täglich um 3 Uhr</mat-chip>
                <mat-chip (click)="cronField.setValue('0 */30 * * * *')">Alle 30 Minuten</mat-chip>
                <mat-chip (click)="cronField.setValue('0 0 8,11 * * 1-5')">Mo-Fr 8 und 11 Uhr</mat-chip>
            </mat-chip-list>
        </div>

        <p>
            Weitere Information über die Verwendung des Cron-Ausdrucks kann hier nachgelesen werden:
            <a target="_blank" href="https://de.wikipedia.org/wiki/Cron">Link</a>
        </p>
        <p>
            Der Cron-Ausdruck beinhaltet zusätzlich die Einstellung von Sekunden, um eine genauere Ausführung zu
            definieren.
        </p>
    </ng-container>

    <div main-header fxFlex *ngIf="isActivated; else noElasticsearch" fxLayoutAlign="center center">
        <div>
            <span *ngIf="!liveImportMessage">Letzte Indizierung erfolgte am {{(lastLog|async)?.lastIndexedDate | date:'dd.LL.yyyy HH:mm'}}</span>
            <span *ngIf="liveImportMessage">Laufende Indizierung seit: {{liveImportMessage.startTime | date:'dd.LL.yyyy HH:mm:ss'}}</span>
            <button mat-icon-button class="dark menu-button" [class.expanded]="showMore" (click)="showMore = !showMore">
                <mat-icon class="animated">keyboard_arrow_down</mat-icon>
            </button>
        </div>

        <div fxFlex></div>

        <div>
            <button mat-flat-button color="primary" (click)="index()">Indizieren</button>
        </div>
    </div>

    <div *ngIf="showMore" status class="status">
        <div fxLayoutAlign="end end" style="padding-bottom: 24px">
            <div class="extra-large-spacing link-text">
                <a href="#" (click)="copyContent($event)">Kopieren</a>
            </div>
        </div>

        <div class="log">
            <div><pre>{{liveImportMessage | json}}</pre></div>
        </div>
    </div>

    <div main-content fxFlex>
        <section>Ausführungsintervall</section>
        <div class="padding section">
            <mat-form-field class="width-100" appearance="outline">
                <mat-label>Cron Ausdruck</mat-label>
                <input [formControl]="cronField" matInput placeholder="*/1 * * * * *">
                <mat-hint>{{hint}}</mat-hint>
            </mat-form-field>
            <button mat-stroked-button (click)="updatePattern(cronField.value)" [disabled]="!valid">Übernehmen</button>
        </div>
    </div>

    <ng-template #noElasticsearch>
        Elasticsearch ist nicht im Backend aktiviert, welches für die Indizierung benötigt wird.
    </ng-template>

</page-template>
