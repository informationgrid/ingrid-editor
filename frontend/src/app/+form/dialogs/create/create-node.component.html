<div cdkDrag cdkDragRootElement=".cdk-overlay-pane" #contextNodeContainer>
    <div cdkDragHandle class="dialog-title-wrapper mat-dialog-title">
        <h2 mat-dialog-title>
            <button mat-icon-button mat-dialog-close data-cy="dlg-close">
                <mat-icon>close</mat-icon>
            </button>
            <span class="text">{{ title }}</span>
        </h2>
    </div>
    <mat-dialog-content class="hide-tab-header create-dlg-content">
        <mat-tab-group [selectedIndex]="selectedPage" dynamicHeight>
            <mat-tab label="Titel">
                <div
                    class="first-tab-wrapper"
                    fxFlex
                    fxLayout="column"
                    [formGroup]="formGroup"
                >
                    <div
                        class="dlg-field-label dlg-create-place no-top-padding"
                    >
                        Zielordner
                    </div>
                    <ige-breadcrumb
                        [path]="path"
                        [rootName]="rootTreeName"
                        [selectable]="true"
                        [disableRoot]="!isAdmin"
                        (select)="quickBreadcrumbChange($event)"
                    ></ige-breadcrumb>
                    <div *ngIf="!pathWithWritePermission" class="error-box">
                        Sie haben keine Schreibrechte auf den Zielordner. Bitte
                        ändern Sie den Zielordner über "Zielordner ändern"
                    </div>

                    <ige-document-template
                        *ngIf="isFolder || !forAddress; else addressForm"
                        [isFolder]="isFolder"
                        [form]="formGroup"
                        (create)="handleCreate()"
                    ></ige-document-template>

                    <ng-template #addressForm>
                        <ige-address-template
                            [form]="formGroup"
                            [isPerson]="isPerson"
                            [parent]="parent"
                            (create)="handleCreate()"
                        ></ige-address-template>
                    </ng-template>
                </div>
            </mat-tab>

            <mat-tab label="Zielordner auswählen">
                <ige-destination-selection
                    [disableRoot]="!isAdmin"
                    [forAddress]="forAddress"
                    [initialSelectedId]="jumpedTreeNodeId"
                    [typeToInsert]="docTypeChoice"
                    (choice)="updateParent($event)"
                ></ige-destination-selection>
            </mat-tab>
        </mat-tab-group>
    </mat-dialog-content>

    <mat-dialog-actions>
        <button
            *ngIf="selectedPage === 1"
            color="primary"
            mat-button
            data-cy="create-back"
            (click)="selectedPage = 0"
            class="back-button"
        >
            <mat-icon>chevron_left</mat-icon>
            <span>Zurück</span>
        </button>

        <div fxFlex></div>

        <!-- The mat-dialog-close directive optionally accepts a value as a result for the dialog. -->
        <button
            *ngIf="selectedPage === 0"
            mat-button
            color="primary"
            data-cy="create-changeLocation"
            (click)="jumpToTree(this.parent)"
        >
            Zielordner ändern
        </button>

        <button
            *ngIf="selectedPage === 0"
            mat-flat-button
            color="primary"
            class="btn-create"
            data-cy="create-action"
            [disabled]="
                formGroup.invalid || (!isAdmin && !pathWithWritePermission)
            "
            (click)="handleCreate()"
        >
            Anlegen
        </button>

        <button
            *ngIf="selectedPage === 1"
            mat-flat-button
            color="primary"
            data-cy="create-applyLocation"
            [disabled]="!isAdmin && !selectedLocation"
            (click)="applyLocation()"
        >
            Übernehmen
        </button>
    </mat-dialog-actions>
</div>
