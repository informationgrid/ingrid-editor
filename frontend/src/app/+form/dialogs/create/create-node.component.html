<div class="dialog-title-wrapper">
    <h2 mat-dialog-title>
        <button mat-icon-button mat-dialog-close data-cy="dlg-close">
            <mat-icon>close</mat-icon>
        </button>
        <span class="text">{{ title }}</span>
    </h2>
</div>
<mat-dialog-content class="hide-tab-header create-dlg-content">
    <mat-tab-group [selectedIndex]="selectedPage" dynamicHeight>
        <mat-tab label="Titel">
            <div
                class="first-tab-wrapper"
                fxFlex
                fxLayout="column"
                [formGroup]="formGroup"
            >
                <ige-document-template
                    *ngIf="isFolder || !forAddress; else addressForm"
                    [form]="formGroup"
                ></ige-document-template>

                <ng-template #addressForm>
                    <ige-address-template
                        [form]="formGroup"
                        [isPerson]="isPerson"
                    ></ige-address-template>
                </ng-template>

                <ng-container *ngIf="documentTypes?.length > 1">
                    <div class="dlg-create-place" id="doc-type">
                        Datensatz/Adresstyp wählen:
                    </div>
                    <ige-document-list-item
                        [docs]="documentTypes"
                        showSelection="true"
                        [denseMode]="true"
                        [hideDivider]="true"
                        [setActiveItem]="initialActiveDocumentType"
                        (select)="setDocType($event)"
                    ></ige-document-list-item>
                </ng-container>

                <div class="dlg-field-label dlg-create-place">Ordner</div>
                <ige-breadcrumb
                    [path]="path"
                    [rootName]="rootTreeName"
                    [selectable]="true"
                    [hideLastSeparator]="true"
                    [disableRoot]="!isAdmin"
                    (select)="quickBreadcrumbChange($event)"
                ></ige-breadcrumb>
                <div *ngIf="!pathWithWritePermission" class="error-box">
                    Sie haben keine Schreibrechte auf den Zielordner
                </div>
            </div>
        </mat-tab>

        <mat-tab label="Ordner auswählen">
            <ige-destination-selection
                [disableRoot]="!isAdmin"
                [forAddress]="forAddress"
                [initialSelectedId]="jumpedTreeNodeId"
                (choice)="updateParent($event)"
            ></ige-destination-selection>
        </mat-tab>
    </mat-tab-group>
</mat-dialog-content>

<mat-dialog-actions>
    <button
        *ngIf="selectedPage === 1"
        color="primary"
        mat-button
        data-cy="create-back"
        (click)="selectedPage = 0"
        class="back-button"
    >
        <mat-icon>chevron_left</mat-icon>
        <span>Zurück</span>
    </button>

    <div fxFlex></div>

    <!-- The mat-dialog-close directive optionally accepts a value as a result for the dialog. -->
    <button
        *ngIf="selectedPage === 0"
        mat-button
        color="primary"
        data-cy="create-changeLocation"
        (click)="jumpToTree(this.parent)"
    >
        Ordner ändern
    </button>

    <button
        *ngIf="selectedPage === 0"
        mat-flat-button
        color="primary"
        class="btn-create"
        data-cy="create-action"
        [disabled]="formGroup.invalid || (!isAdmin && !pathWithWritePermission)"
        (click)="handleCreate()"
    >
        Anlegen
    </button>

    <button
        *ngIf="selectedPage === 1"
        mat-flat-button
        color="primary"
        data-cy="create-applyLocation"
        [disabled]="!isAdmin && !selectedLocation"
        (click)="applyLocation()"
    >
        Übernehmen
    </button>
</mat-dialog-actions>
