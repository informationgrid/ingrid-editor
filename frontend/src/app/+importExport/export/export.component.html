<page-template label="Export">
    <div left-side>Hier können Sie ein oder mehrere Dateien exportieren.</div>

    <section main-header fxLayoutAlign="center center">
        <div>
            Letzter Export erfolgt am xx.xx.xxxx, xx:xx:xx (xx Datensätze)

            <button
                mat-icon-button
                class="dark menu-button"
                [class.expanded]="showMore"
                (click)="showMore = !showMore"
            >
                <mat-icon class="animated">keyboard_arrow_down</mat-icon>
            </button>
        </div>
    </section>

    <section main-content fxFlex>
        <mat-horizontal-stepper #stepper [linear]="true" labelPosition="bottom">
            <mat-step [completed]="datasetSelected">
                <ng-template matStepLabel>Datensatz wählen</ng-template>
                <ige-tree (selected)="selectDatasets($event)"></ige-tree>

                <mat-divider></mat-divider>

                <div class="action-bar" fxLayoutAlign="end">
                    <button
                        mat-flat-button
                        color="primary"
                        matStepperNext
                        [disabled]="!datasetSelected"
                    >
                        Weiter
                    </button>
                </div>
            </mat-step>
            <mat-step [stepControl]="optionsFormGroup">
                <form [formGroup]="optionsFormGroup">
                    <ng-template matStepLabel>Optionen wählen</ng-template>

                    <div class="section-title">Ort</div>
                    <ige-breadcrumb [path]="path"></ige-breadcrumb>

                    <div class="section-title space">Export</div>

                    <mat-radio-group
                        class="radio-vertical"
                        formControlName="option"
                    >
                        <mat-radio-button
                            name="exportOption"
                            value="dataset"
                            checked
                            >nur diesen Datensatz
                        </mat-radio-button>
                        <mat-radio-button name="exportOption" value="sub"
                            >alle untergeordneten
                        </mat-radio-button>
                        <mat-radio-button name="exportOption" value="thisAndSub"
                            >dieser und alle untergeordneten
                        </mat-radio-button>
                    </mat-radio-group>

                    <div class="section-title space">Datensätze</div>
                    <mat-checkbox
                        formControlName="drafts"
                        style="margin-top: 12px; display: block"
                    >
                        Auch Entwürfe exportieren
                    </mat-checkbox>

                    <div class="section-title space">Format</div>
                    <mat-form-field appearance="outline" style="width: 300px">
                        <mat-select formControlName="format">
                            <mat-option
                                *ngFor="let format of exportFormats | async"
                                [value]="format"
                            >
                                {{ format.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </form>
                <div class="action-bar">
                    <button mat-button (click)="cancel()">Abbrechen</button>
                    <div fxFlex></div>
                    <button mat-button matStepperPrevious>Zurück</button>
                    <button
                        mat-flat-button
                        color="primary"
                        matStepperNext
                        (click)="runExport()"
                        [disabled]="optionsFormGroup.invalid"
                    >
                        Weiter
                    </button>
                </div>
            </mat-step>
            <mat-step>
                <ng-template matStepLabel>Vorschau</ng-template>

                <div fxLayoutAlign="center center" fxLayout="column">
                    <div class="section-title">Exportdatei erstellt:</div>
                    <mat-icon
                        class="big-icon gray"
                        svgIcon="Fachaufgabe"
                    ></mat-icon>
                    <button mat-stroked-button (click)="showPreview()">
                        Vorschau
                    </button>
                </div>

                <div class="action-bar">
                    <button mat-button (click)="cancel()">Abbrechen</button>
                    <div fxFlex></div>
                    <button mat-button matStepperPrevious>Zurück</button>
                    <button
                        mat-flat-button
                        color="primary"
                        matStepperNext
                        (click)="downloadExport()"
                    >
                        Exportieren
                    </button>
                </div>
            </mat-step>
            <mat-step>
                <ng-template matStepLabel>Fertig</ng-template>

                <div fxLayoutAlign="center center" fxLayout="column">
                    <div class="section-title">Datei exportiert</div>
                    <mat-icon class="big-icon success-icon"
                        >check_circle_outline</mat-icon
                    >
                    <div>
                        Die Datei wurde in Ihrem Download-Ordner abgelegt.
                    </div>
                </div>
                <div class="action-bar">
                    <div fxFlex></div>
                    <button mat-flat-button color="primary" (click)="cancel()">
                        Neuer Export
                    </button>
                </div>
            </mat-step>
        </mat-horizontal-stepper>
    </section>
</page-template>

<pre *ngIf="exportResult">{{ exportResult }}</pre>
