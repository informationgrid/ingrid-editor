<page-template label="Katalogverwaltung">
    <div left-side>Auf dieser Seite können die Kataloge verwaltet werden.</div>

    <div main-header class="flex-col justify-content-start align-items-stretch">
        <div *ngIf="profiles">
            <ige-add-button
                buttonType="flat"
                (add)="showCreateCatalogDialog()"
            ></ige-add-button>
        </div>
        <p *ngIf="noAssignedCatalogs">
            Sie sind noch keinem Katalog zugewiesen. Erst wenn Sie einem Katalog
            angehören, können Sie zusätzliche Operationen ausführen.
        </p>
    </div>

    <div main-content>
        <div class="section-title">Aktiver Katalog</div>
        <div class="flex-row" style="padding-bottom: 48px">
            <div
                *ngIf="activeCatalog | async as catalog"
                class="catalog-wrapper"
            >
                <ng-container
                    [ngTemplateOutlet]="catContent"
                    [ngTemplateOutletContext]="{ cat: catalog }"
                ></ng-container>
            </div>
        </div>

        <div class="section-title">Weitere Kataloge</div>
        <div class="flex-row flex-wrap gap-36">
            <div
                *ngFor="
                    let cat of nonActiveCatalogs | async;
                    trackBy: trackByCatalogId
                "
                class="catalog-wrapper"
            >
                <ng-container
                    [ngTemplateOutlet]="catContent"
                    [ngTemplateOutletContext]="{ cat: cat }"
                ></ng-container>
            </div>

            <mat-spinner *ngIf="showSpinner" diameter="50"></mat-spinner>
        </div>
    </div>

    <ng-template #catContent let-cat="cat">
        <mat-card
            appearance="outlined"
            class="hover-elevate"
            [attr.data-cy]="cat.label"
            [class.selected]="cat.id === currentCatalog"
        >
            <mat-card-content>
                <div class="header">
                    <mat-icon>article</mat-icon>
                    <div class="profile">{{ cat.type }}</div>
                    <div class="flex-1"></div>
                    <button
                        mat-icon-button
                        class="menu dark menu-button"
                        matTooltip="Bearbeiten"
                        [matMenuTriggerFor]="catMenu"
                    >
                        <mat-icon svgIcon="Mehr"></mat-icon>
                    </button>
                    <mat-menu #catMenu>
                        <button mat-menu-item (click)="showCatalogDetail(cat)">
                            Bearbeiten
                        </button>
                        <button mat-menu-item (click)="chooseCatalog(cat.id)">
                            Aktivieren
                        </button>
                    </mat-menu>
                </div>

                <div class="title">{{ cat.label }}</div>
                <div *ngIf="cat.lastDocModification" class="subtitle">
                    Letzte Änderung am
                    {{ cat.lastDocModification | date: "dd.LL.yyyy HH:mm" }}
                </div>
                <div *ngIf="!cat.lastDocModification" class="subtitle">
                    Erstellt am
                    {{ cat.created | date: "dd.LL.yyyy HH:mm" }}
                </div>

                <div
                    *ngIf="cat.countDocuments !== undefined; else spinner"
                    class="content"
                >
                    {{ cat.countDocuments | number }} Datensätze
                </div>
                <ng-template #spinner>
                    <mat-spinner diameter="18"></mat-spinner>
                    Hole Statistik
                </ng-template>
            </mat-card-content>
        </mat-card>
    </ng-template>
</page-template>
