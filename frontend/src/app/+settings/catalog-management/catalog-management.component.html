<page-template label="Katalogverwaltung">
    <div left-side>Auf dieser Seite können die Kataloge verwaltet werden.</div>

    <div main-header fxFlex fxLayoutAlign="start" fxLayout="column">
        <div *ngIf="profiles">
            <ige-add-button
                buttonType="flat"
                (add)="showCreateCatalogDialog()"
            ></ige-add-button>
        </div>
        <p *ngIf="noAssignedCatalogs">
            Sie sind noch keinem Katalog zugewiesen. Erst wenn Sie einem Katalog
            angehören, können Sie zusätzliche Operationen ausführen.
        </p>
    </div>

    <div main-content>
        <div class="section-title">Aktiver Katalog</div>
        <div fxLayout="row" style="padding-bottom: 48px">
            <div fxFlex="25" class="catalog-wrapper">
                <mat-card
                    appearance="outlined"
                    class="hover-elevate selected"
                    [attr.data-cy]="catalog.label"
                    *ngIf="activeCatalog | async as catalog"
                >
                    <div class="card-header">
                        <mat-icon>article</mat-icon>
                        <span class="profile">{{ catalog.type }}</span>
                        <div fxFlex></div>
                        <button
                            mat-icon-button
                            class="menu dark menu-button"
                            [matMenuTriggerFor]="catMenu"
                        >
                            <mat-icon svgIcon="Mehr"></mat-icon>
                        </button>
                        <mat-menu #catMenu>
                            <button
                                mat-menu-item
                                (click)="showCatalogDetail(catalog)"
                            >
                                Bearbeiten
                            </button>
                        </mat-menu>
                    </div>

                    <ng-container
                        [ngTemplateOutlet]="catContent"
                        [ngTemplateOutletContext]="{ cat: catalog }"
                    ></ng-container>
                </mat-card>
            </div>
        </div>

        <div class="section-title">Weitere Kataloge</div>
        <div fxLayout="row wrap" fxLayoutGap="48px grid">
            <div
                *ngFor="
                    let cat of nonActiveCatalogs | async;
                    trackBy: trackByCatalogId
                "
                class="catalog-wrapper"
            >
                <mat-card
                    appearance="outlined"
                    class="hover-elevate"
                    [attr.data-cy]="cat.label"
                    [class.selected]="cat.id === currentCatalog"
                >
                    <div class="card-header">
                        <mat-icon>article</mat-icon>
                        <span class="profile">{{ cat.type }}</span>
                        <div fxFlex></div>
                        <button
                            mat-icon-button
                            class="menu dark menu-button"
                            [matMenuTriggerFor]="catMenu"
                        >
                            <mat-icon svgIcon="Mehr"></mat-icon>
                        </button>
                        <mat-menu #catMenu>
                            <button
                                mat-menu-item
                                (click)="showCatalogDetail(cat)"
                            >
                                Bearbeiten
                            </button>
                            <button
                                mat-menu-item
                                (click)="chooseCatalog(cat.id)"
                            >
                                Aktivieren
                            </button>
                        </mat-menu>
                    </div>

                    <ng-container
                        [ngTemplateOutlet]="catContent"
                        [ngTemplateOutletContext]="{ cat: cat }"
                    ></ng-container>
                </mat-card>
            </div>

            <mat-spinner *ngIf="showSpinner" diameter="50"></mat-spinner>
        </div>
    </div>

    <ng-template #catContent let-cat="cat">
        <mat-card-title>{{ cat.label }}</mat-card-title>
        <mat-card-subtitle *ngIf="cat.lastDocModification">
            Letzte Änderung am
            {{ cat.lastDocModification | date : "dd.LL.yyyy HH:mm" }}
        </mat-card-subtitle>
        <mat-card-subtitle *ngIf="!cat.lastDocModification">
            Erstellt am {{ cat.created | date : "dd.LL.yyyy HH:mm" }}
        </mat-card-subtitle>
        <mat-card-content
            *ngIf="cat.countDocuments !== undefined; else spinner"
        >
            <div class="content">
                {{ cat.countDocuments | number }} Datensätze
            </div>
        </mat-card-content>
        <ng-template #spinner>
            <mat-spinner diameter="18"></mat-spinner>
            Hole Statistik
        </ng-template>
    </ng-template>
</page-template>
