<page-template label="URL-Pflege">
    <div left-side></div>
    <div main-header>
        <div fxFlex fxLayoutAlign="center center" fxLayoutGap="12px">
            <ng-container *ngIf="liveLog | async as log">
                <span *ngIf="!isRunning; else running"
                    >Letzte Pr端fung erfolgte am
                    {{ log.startTime | date: "dd.LL.yyyy HH:mm" }}</span
                >
                <ng-template #running>
                    <mat-progress-spinner
                        [value]="log.progress"
                        diameter="16"
                        [matTooltip]="log.progress + '%'"
                    ></mat-progress-spinner>
                    <span>
                        Laufende Pr端fung seit:
                        {{ log.startTime | date: "dd.LL.yyyy HH:mm:ss" }}</span
                    >
                </ng-template>
                <button
                    mat-icon-button
                    class="dark menu-button"
                    [class.expanded]="showMore"
                    (click)="showMore = !showMore"
                >
                    <mat-icon class="animated">keyboard_arrow_down</mat-icon>
                </button>
            </ng-container>
        </div>

        <div>
            <button
                *ngIf="!isRunning; else stopJob"
                mat-flat-button
                color="primary"
                (click)="start()"
            >
                Pr端fung starten
            </button>
            <ng-template #stopJob>
                <button mat-flat-button color="primary" (click)="stop()">
                    Pr端fung stoppen
                </button>
            </ng-template>
        </div>
    </div>

    <div status class="status" [class.hide]="!showMore">
        <div *ngIf="liveLog | async as log">
            <div>Start: {{ log.startTime | date: "dd.LL.yyyy HH:mm:ss" }}</div>
            <div>Ende: {{ log.endTime | date: "dd.LL.yyyy HH:mm:ss" }}</div>
            <div>Analysierte URLs: ???</div>
        </div>
    </div>

    <div main-content fxLayout="column" fxLayoutGap="36px">
        <table
            mat-table
            [dataSource]="dataSource"
            matSort
            class="width-100 no-action-column"
        >
            <ng-container matColumnDef="_select_" class="thin-column">
                <th mat-header-cell *matHeaderCellDef>Alle</th>
                <td mat-cell *matCellDef="let element">
                    <mat-checkbox
                        (click)="$event.stopPropagation()"
                        (change)="$event ? selection.toggle(element) : null"
                        [checked]="selection.isSelected(element)"
                    >
                        <!--[aria-label]="checkboxLabel(row)"-->
                    </mat-checkbox>
                </td>
            </ng-container>
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    Status
                </th>
                <td mat-cell *matCellDef="let element">
                    {{ element.status }}
                </td>
            </ng-container>
            <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Typ</th>
                <td mat-cell *matCellDef="let element">
                    <!--                    <mat-icon [svgIcon]="element.type"></mat-icon>-->
                    {{ element.type }}
                </td>
            </ng-container>
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    Name/URL
                </th>
                <td mat-cell *matCellDef="let element">
                    <div>{{ element.title }}</div>
                    <div>
                        <a
                            class="no-text-transform"
                            [href]="element.url"
                            target="_blank"
                            >{{ element.url }}</a
                        >
                    </div>
                </td>
            </ng-container>
            <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    Beschreibung
                </th>
                <td mat-cell *matCellDef="let element">
                    {{ element.description }}
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr
                mat-row
                *matRowDef="let row; columns: displayedColumns"
                (click)="selection.toggle(row)"
            ></tr>
        </table>
    </div>
</page-template>
