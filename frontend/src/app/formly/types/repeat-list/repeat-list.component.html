<div
    *ngIf="field.fieldGroup.length > 0"
    class="component-list"
    cdkDropList
    cdkDropListOrientation="vertical"
    (cdkDropListDropped)="drop($event)"
>
    <div
        *ngFor="let field of field.fieldGroup; let i = index"
        cdkDrag
        [cdkDragDisabled]="to.noDrag"
        class="clickable list-item"
        (click)="this.onItemClick(model[i]?.key)"
    >
        <span class="list-display-element">
            <mat-icon
                *ngIf="this.to.elementIcon"
                [svgIcon]="this.to.elementIcon"
            ></mat-icon>
            {{ getParameter(model[i]) }}
        </span>
        <button
            type="button"
            mat-icon-button
            class="close gray"
            (click)="removeItem(i)"
        >
            <mat-icon svgIcon="Entfernen"></mat-icon>
        </button>
    </div>
</div>

<mat-form-field
    *ngIf="to.asSelect; else templateAutocomplete"
    appearance="outline"
    class="width-100"
>
    <mat-select
        [placeholder]="to.placeholder"
        (valueChange)="addToList($event)"
        [formControl]="inputControl"
    >
        <mat-option *ngIf="to.showSearch">
            <ngx-mat-select-search
                [formControl]="filterCtrl"
            ></ngx-mat-select-search>
        </mat-option>
        <mat-option
            *ngFor="let option of filteredOptions | async"
            [value]="option"
            [disabled]="option.disabled"
        >
            <div (click)="onOptionClick($event, option)">
                {{ option.label }}
            </div>
        </mat-option>
    </mat-select>
</mat-form-field>

<ng-template #templateAutocomplete>
    <mat-form-field appearance="outline" class="width-100">
        <mat-icon
            *ngIf="parameterOptions && repeatListInput.value.length === 0"
            class="gray"
            matPrefix
            >search
        </mat-icon>
        <input
            type="text"
            #repeatListInput
            [placeholder]="to.placeholder"
            matInput
            [formControl]="inputControl"
            [required]="to.required && formControl.invalid"
            (keydown.enter)="addFreeEntry(repeatListInput.value)"
            [matAutocomplete]="auto"
        />
        <mat-autocomplete
            #auto="matAutocomplete"
            (optionSelected)="addToList($event.option.value)"
        >
            <mat-option
                *ngFor="let option of filteredOptions | async"
                [value]="option"
                [disabled]="option.disabled"
            >
                {{ option.label }}
            </mat-option>
        </mat-autocomplete>
        <button
            *ngIf="repeatListInput.value.length > 0"
            mat-icon-button
            matSuffix
            class="field-close"
            (click)="repeatListInput.value = ''"
        >
            <mat-icon class="gray" svgIcon="Entfernen"></mat-icon>
        </button>
        <mat-hint *ngIf="!parameterOptions"
            >Eingabe mit RETURN best√§tigen
        </mat-hint>
    </mat-form-field>
    <mat-error *ngIf="formControl.errors?.required"
        >Bitte erstellen Sie mindestens einen Eintrag
    </mat-error>
</ng-template>
