<div
    *ngIf="field.fieldGroup.length > 0; else noFieldsSelected"
    class="component-list"
    cdkDropList
    cdkDropListOrientation="vertical"
    (cdkDropListDropped)="drop($event)"
>
    <div
        *ngFor="let field of field.fieldGroup; let i = index"
        cdkDrag
        [cdkDragDisabled]="
            props.noDrag || formControl.disabled || model.length < 2
        "
        class="clickable list-item"
        tabindex="0"
        (keydown.delete)="removeItem(i, $event)"
        (keydown.backspace)="removeItem(i, $event)"
        (click)="$event.target.focus() && this.onItemClick(model[i]?.key)"
    >
        <div class="text-wrapper">
            <span class="list-display-element">
                <mat-icon
                    *ngIf="this.props.elementIcon"
                    [svgIcon]="this.props.elementIcon"
                ></mat-icon>
                {{ getParameter(model[i]) }}
            </span>
        </div>
        <button
            *ngIf="formControl.enabled"
            type="button"
            mat-icon-button
            class="close gray"
            (click)="removeItem(i)"
        >
            <!--            <mat-icon svgIcon="Entfernen"></mat-icon>-->
            <mat-icon>close</mat-icon>
        </button>
    </div>
</div>
<ng-template #noFieldsSelected>
    <div
        *ngIf="this.props.selectionEmptyNotice"
        class="no-fields-selected-notice"
    >
        <div class="infoIcon">
            <mat-icon
                class="material-icons-outlined"
                svgIcon="info-24px"
            ></mat-icon>
        </div>
        <span>{{ this.props.selectionEmptyNotice }}</span>
    </div>
</ng-template>

<mat-form-field
    *ngIf="props.asSelect; else templateAutocomplete"
    appearance="outline"
    class="width-100"
>
    <mat-select
        [placeholder]="props.placeholder"
        (valueChange)="addToList($event)"
        [formControl]="inputControl"
        (keydown)="handleKeydown($event)"
        (blur)="inputControl.setValue('')"
    >
        <mat-option *ngIf="props.showSearch">
            <ngx-mat-select-search
                [formControl]="filterCtrl"
            ></ngx-mat-select-search>
        </mat-option>
        <mat-option
            *ngFor="let option of filteredOptions | async"
            [value]="option"
            [disabled]="option.disabled"
        >
            <div (click)="onOptionClick($event, option)">
                {{ option.label }}
            </div>
        </mat-option>
    </mat-select>
    <mat-error>Bitte erstellen Sie mindestens einen Eintrag</mat-error>
</mat-form-field>

<ng-template #templateAutocomplete>
    <mat-form-field appearance="outline" class="width-100">
        <mat-label *ngIf="props.fieldLabel">{{ props.fieldLabel }}</mat-label>
        <mat-icon
            *ngIf="parameterOptions && repeatListInput.value.length === 0"
            class="search-icon gray"
            matPrefix
            >search
        </mat-icon>
        <input
            type="text"
            #repeatListInput
            [placeholder]="props.placeholder"
            matInput
            [formControl]="inputControl"
            (keydown.enter)="addFreeEntry(repeatListInput.value)"
            [matAutocomplete]="auto"
        />
        <mat-autocomplete
            #auto="matAutocomplete"
            (optionSelected)="addToList($event.option.value)"
        >
            <mat-option
                *ngFor="let option of filteredOptions | async"
                [value]="option"
                [disabled]="option.disabled"
            >
                {{ option.label }}
            </mat-option>
        </mat-autocomplete>

        <!-- clean button -->
        <button
            *ngIf="repeatListInput.value.length > 0"
            mat-icon-button
            matSuffix
            type="button"
            class="field-close"
            (click)="repeatListInput.value = ''"
        >
            <mat-icon class="gray" svgIcon="Entfernen"></mat-icon>
        </button>

        <!-- help info button -->
        <ng-container
            *ngIf="props.suffix"
            matSuffix
            [ngTemplateOutlet]="props.suffix"
        ></ng-container>

        <mat-hint *ngIf="!parameterOptions"
            >Eingabe mit RETURN best√§tigen
        </mat-hint>
        <mat-error>Bitte erstellen Sie mindestens einen Eintrag</mat-error>
    </mat-form-field>
</ng-template>
