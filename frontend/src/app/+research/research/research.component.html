<mat-tab-group animationDuration="0" class="page-tabs" [(selectedIndex)]="selectedIndex">

    <mat-tab label="Erweiterte Suche">
        <div fxLayout="row" fxLayoutGap="20px" class="padding">

            <div fxLayout="column">
                <ige-facets [model]="filter.model"
                            (update)="updateFilter($event)"></ige-facets>
            </div>

            <div fxFlex fxLayout="column">
                <mat-form-field appearance="outline" class="width-100">
                    <mat-label>Suche</mat-label>
                    <input matInput [formControl]="query">
                </mat-form-field>

                <ng-container *ngTemplateOutlet="tableTemplate"></ng-container>

            </div>

        </div>
    </mat-tab>

    <mat-tab>
        <ng-template mat-tab-label>
            <mat-icon>star</mat-icon>
            <span> Favoriten</span>
        </ng-template>
        <ige-query-manager (selection)="loadQuery($event)"></ige-query-manager>
    </mat-tab>

    <mat-tab label="SQL">
        <div class="padding" fxLayout="column">
            <mat-form-field appearance="outline" class="width-100">
                <!--                        <mat-label>SQL-Query</mat-label>-->
                <textarea #sql matInput rows="5" placeholder="SELECT * FROM ..." [value]="sqlValue"></textarea>
            </mat-form-field>

            <div>
                <span [matMenuTriggerFor]="examples">Beispiele</span>
                <mat-menu #examples="matMenu">
                    <button mat-menu-item (click)="updateSql(0)">Alle Adressen, die "test" im Titel beinhalten</button>
                    <button mat-menu-item (click)="updateSql(1)">Alle Dokumente, mit Kategorie "Luft- und Raumfahrt"
                    </button>
                </mat-menu>

                <button mat-raised-button (click)="queryBySQL(sql.value)">Abschicken</button>
            </div>

            <ng-container *ngTemplateOutlet="tableTemplate"></ng-container>
        </div>
    </mat-tab>
</mat-tab-group>

<ng-template #tableTemplate>

    <div fxFlex="1">
        <mat-form-field appearance="outline" class="width-100">
            <mat-label>Spalten</mat-label>
            <mat-select multiple [(ngModel)]="displayedColumns">
                <mat-option *ngFor="let column of columnsMap"
                            [value]="column.value">{{column.label || column.value}}</mat-option>
            </mat-select>
        </mat-form-field>
        <!--<button mat-button [matMenuTriggerFor]="columns">Spalten</button>
        <mat-menu #columns="matMenu">
            <button *ngFor="let column of columnsMap" mat-menu-item (click)="toggleColumn(column.value)">{{column.label || column.value}}</button>
        </mat-menu>-->

        <div fxLayout="row">
            <div class="result">{{totalHits}} Ergebnisse</div>
            <div fxFlex></div>
            <button mat-icon-button (click)="saveQuery()">
                <mat-icon>star</mat-icon>
            </button>
            <mat-divider [vertical]="true"></mat-divider>
            <button mat-button (click)="exporter.exportTable('csv', {fileName: 'research'})">CSV</button>
        </div>
        <table mat-table matTableExporter #exporter="matTableExporter" [dataSource]="dataSource" matSort
               class="width-100">

            <!--- Note that these columns can be defined in any order.
                  The actual rendered columns are set as a property on the row definition" -->
            <ng-container *ngFor="let column of columnsMap" [matColumnDef]="column.value">
                <th mat-header-cell *matHeaderCellDef mat-sort-header [class.thin-column]="column.value === '_type'"> {{column.label || column.value}}</th>
                <td mat-cell *matCellDef="let element">
                    <ng-container *ngIf="column.value === '_type'; else showValue">
<!--                        <mat-icon [svgIcon]="profileIconsMap[element[column.value]]"></mat-icon>-->
                        <ige-document-icon [doc]="element"></ige-document-icon>
                    </ng-container>
                    <ng-template #showValue>
                        {{element[column.value]}}
                    </ng-template>
                </td>
            </ng-container>

            <ng-container matColumnDef="settings">
                <th mat-header-cell *matHeaderCellDef mat-sort-header class="thin-column"></th>
                <td mat-cell *matCellDef="let element" class="settings">
                    <button mat-icon-button [matMenuTriggerFor]="moreResult">
                        <mat-icon svgIcon="Mehr"></mat-icon>
                    </button>
                    <mat-menu #moreResult>
                        <button mat-menu-item>Ã–ffnen</button>
                    </mat-menu>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <mat-paginator [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons></mat-paginator>
    </div>

</ng-template>
