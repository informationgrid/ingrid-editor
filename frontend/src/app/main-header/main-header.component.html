<mat-toolbar *transloco="let t; read: 'menu'">
    <mat-toolbar-row
        class="header-row medium-spacing"
        [class.showShadow]="showShadow"
    >
        <div class="header-logo"><img src="{{ t('logo') }}" /></div>
        <span class="page-title-general"
            ><strong>{{ t("application") }}</strong> EDITOR</span
        >
        <span class="main-page-title">{{ pageTitle ? t(pageTitle) : "" }}</span>

        <div class="center-header flex-grow">
            <ige-session-timeout-info
                *ngIf="timeout$ | async as timer"
                [timeout]="timer"
                [class.show]="timer < 300"
            ></ige-session-timeout-info>
        </div>

        <div
            *ngIf="currentCatalog$ | async as currentCatalog"
            class="header-info flex-grow"
        >
            Katalog:
            <span
                class="catalog-title"
                [matTooltip]="currentCatalog"
                [matTooltipShowDelay]="1000"
                [matMenuTriggerFor]="catMenu"
                [class.empty-menu]="otherAssignedCatalogs.length == 0"
                >{{ currentCatalog }}
                <mat-icon *ngIf="otherAssignedCatalogs.length > 0"
                    >keyboard_arrow_down</mat-icon
                >
            </span>
            <mat-menu #catMenu="matMenu">
                <span
                    *ngFor="let catalog of otherAssignedCatalogs"
                    mat-menu-item
                    (click)="chooseCatalog(catalog.id)"
                >
                    {{ catalog.name }}
                </span>
            </mat-menu>
        </div>

        <span *ngIf="userInfo$ | async as userInfo" class="flex-row">
            <button
                type="button"
                class="user-popup pad-right"
                mat-icon-button
                [matMenuTriggerFor]="menu"
                data-cy="header-profile-button"
            >
                {{ initials }}
            </button>
            <mat-menu #menu="matMenu" class="user-popup-menu">
                <div class="user-popup-header">
                    <mat-card-title
                        >{{ userInfo.firstName }}
                        {{ userInfo.lastName }}</mat-card-title
                    >
                    <p
                        class="last-login"
                        title="{{ userInfo.lastLogin | date : 'short' }}"
                    >
                        Letzte Anmeldung: {{ userInfo.lastLogin | date }}
                    </p>
                </div>
                <!--<span
                    mat-menu-item
                    disabled
                    [disableRipple]="true"
                    (click)="$event.stopPropagation()"
                >
                    <mat-icon svgIcon="german_flag-24px"></mat-icon>
                    Sprache: Deutsch
                    <mat-icon>arrow_drop_down</mat-icon>
                </span>-->
                <span
                    mat-menu-item
                    [disableRipple]="true"
                    (click)="openProfileSettings()"
                >
                    <mat-icon svgIcon="perm_identity-24px"></mat-icon>
                    Profil verwalten
                </span>
                <!--<span
                    mat-menu-item
                    disabled
                    [disableRipple]="true"
                    (click)="$event.stopPropagation()"
                >
                    <mat-icon svgIcon="baseline-settings-24px"></mat-icon>
                    Einstellungen
                </span>-->
                <div class="user-popup-footer">
                    <button
                        mat-button
                        color="primary"
                        (click)="logout()"
                        data-cy="logout-button"
                    >
                        Abmelden
                    </button>
                </div>
            </mat-menu>

            <button
                type="button"
                class="user-popup"
                mat-icon-button
                [matMenuTriggerFor]="menuInfo"
                data-cy="header-info-button"
            >
                <mat-icon svgIcon="Mehr"></mat-icon>
            </button>
            <mat-menu #menuInfo="matMenu" class="info-menu user-popup-menu">
                <div class="user-popup-header">
                    <mat-card-title
                        ><strong>{{ t("application") }}</strong>
                        EDITOR</mat-card-title
                    >
                </div>

                <div *ngFor="let group of config.menuGroups">
                    <div *ngIf="!group.adminOnly || isAdmin">
                        <span mat-menu-item disabled class="category-item">{{
                            group.title
                        }}</span>
                        <mat-divider></mat-divider>
                        <div *ngFor="let entry of group.entries">
                            <button
                                *ngIf="entry.isRouterLink"
                                mat-menu-item
                                [routerLink]="[catalogId + '/' + entry.link]"
                            >
                                {{ entry.label }}
                            </button>
                            <a
                                *ngIf="!entry.isRouterLink"
                                mat-menu-item
                                href="{{ entry.link }}"
                                target="_blank"
                                >{{ entry.label }}</a
                            >
                            <mat-divider></mat-divider>
                        </div>
                    </div>
                </div>
                <a
                    mat-menu-item
                    href="{{ externalHelp ?? '#' }}"
                    target="_blank"
                    >Hilfe</a
                >

                <mat-divider></mat-divider>
                <div (click)="$event.stopPropagation()" class="versioninfo">
                    <div>Version</div>
                    <div>
                        {{ version.version }},
                        {{ version.date | date : "dd.LL.yyyy, HH:mm" }}
                    </div>
                    <div>GIT Commit ID</div>
                    <div>{{ version.commitId }}</div>
                </div>
            </mat-menu>
        </span>
    </mat-toolbar-row>
</mat-toolbar>
