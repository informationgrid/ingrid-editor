<ige-dialog-template
    label="Schlagworte
konsolidieren"
    (submit)="saveConsolidatedKeywords(); saveButtonClicked = true"
    [disabled]="isLoading || saveButtonClicked"
>
    <ng-container content>
        @if (this.hasKeywords) {
            @if (!isLoading) {
                <div class="no-selection-text">
                    Bestehende Schlagworte werden hier auf ihre Aktualität
                    geprüft. Grün hinterlegte Schlagworte werden der Liste
                    hinzugefügt. Rot hinterlegte Schlagworte werden entfernt.
                </div>
                @for (keywordType of keywordDialogData; track keywordType) {
                    @if (keywordType.condition) {
                        <div
                            class="keyword-section flex-row"
                            [attr.aria-label]="keywordType.label"
                        >
                            <div class="label-wrapper">
                                <label>{{ keywordType.label }}</label>
                            </div>
                            <mat-chip-listbox class="flex-1 flex-wrap">
                                @for (
                                    keyword of keywordType["keywords"];
                                    track keyword
                                ) {
                                    <mat-chip
                                        [ngClass]="{
                                            'added-keyword':
                                                keyword.status === 'added',
                                            'removed-keyword':
                                                keyword.status === 'removed',
                                            'unchanged-keyword':
                                                keyword.status === 'unchanged'
                                        }"
                                        [aria-label]="keyword.label"
                                    >
                                        {{ keyword.label }}
                                        @if (keyword.status === "removed") {
                                            <mat-icon
                                                svgIcon="baseline-clear-24px"
                                            ></mat-icon>
                                        }
                                        @if (keyword.status === "added") {
                                            <mat-icon
                                                svgIcon="baseline-add-24px"
                                            ></mat-icon>
                                        }
                                    </mat-chip>
                                }
                            </mat-chip-listbox>
                        </div>
                    }
                }
                @if (timedOutKeywords.length) {
                    <div class="error-box flex-row align-items-center">
                        Verbindungsprobleme bei:
                        {{ timedOutThesauri.join(", ") }}. Folgende Schlagworte
                        werden den Freien Schlagworten zugeordnet:
                        {{ timedOutKeywords.join(", ") }}
                    </div>
                }
            } @else {
                <div class="flex-row justify-content-center align-items-center">
                    <mat-spinner
                        class="content-spinner"
                        diameter="40"
                    ></mat-spinner>
                </div>
            }
            <div class="help flex-row align-items-center">
                <mat-icon svgIcon="info-24px"></mat-icon>
                @if (!isLoading) {
                    <div class="legend">
                        Klicken sie auf "Übernehmen" um die Änderungen zu
                        speichern.
                    </div>
                }
                @if (isLoading) {
                    <div class="legend">
                        Die Schlagworte werden analysiert. Bitte warten Sie
                        einen Moment.
                    </div>
                }
            </div>
        } @else {
            <div class="no-selection-text">
                Zurzeit sind keine Schlagworte vorhanden.
            </div>
            <div class="help flex-row align-items-center">
                <mat-icon svgIcon="info-24px"></mat-icon>
                <div class="legend">
                    Bitte fügen Sie Schlagworte hinzu, um diese zu
                    konsolidieren.
                </div>
            </div>
        }
    </ng-container>

    <ng-container actions>
        @if (!this.isLoading && this.hasKeywords && timedOutKeywords.length) {
            <button
                color="secondary"
                mat-flat-button
                data-cy="save-btn"
                id="retry-btn"
                [disabled]="isLoading || saveButtonClicked"
                (click)="consolidateKeywords()"
            >
                <span> Wiederholen </span>
            </button>
        }
    </ng-container>
</ige-dialog-template>
