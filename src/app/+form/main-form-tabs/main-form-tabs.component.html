<!-- RENDER ALL RUBRICS AS TABS -->
<!--<ng-container *ngIf="categories.length > 0">
    <ul class="nav nav-tabs">
        <ng-container *ngFor="let category of categories">
            <li class="nav-item" role="presentation" [class.active]="currentCategory === category.label">
                <a class="nav-link" (click)="currentCategory = category.label">{{category.label}}</a>
            </li>
        </ng-container>
    </ul>
</ng-container>-->

<!-- RENDER ALL FIELDS -->
<!--<div *ngIf="field.controlType !== 'rubric' || (field.controlType === 'rubric' && currentCategory === field.label)"-->
<!-- only directly below ul-container with tabs! -->
<ng-container [class.rubricContent]="isRootLevel">
    <ng-container *ngFor="let field of fields">
         <!--class="{{field.domClass}}"
         [ngClass]="{
            hasChildren: field.children,
            padding: !field.children || field.isRepeatable,
            rubricContent: field.controlType === 'rubric',
            fieldContainer: field.controlType !== 'rubric' || (field.controlType === 'rubric' && currentCategory === field.label)
            }">-->

        <!-- SIMPLE FIELD -->
        <div *ngIf="!field.children" class="{{field.domClass}}">
            <dyn-field [class.blur]="blurAllBut && blurAllBut !== field.key"
                       [class.highlight]="blurAllBut && blurAllBut === field.key"
                       [scrollTo]="blurAllBut && blurAllBut === field.key"
                       [field]="field"
                       [form]="form"
                       (onAddSection)="addSection($event)"></dyn-field>
        </div>

        <!-- COMPLEX FIELD -->
        <ng-container *ngIf="field.children" [formGroup]="form">

            <!-- CONTAINER FOR NESTED FIELDS -->
            <ng-container *ngIf="!field.isRepeatable">

                <!-- nest fields also within json -->
                <ng-container *ngIf="field.key" [formGroupName]="field.key">
                    <div class="{{field.domClass}}">
                        <ige-main-form-tabs [form]="form.controls[field.key]"
                                            [isRootLevel]="false"
                                            [blurAllBut]="blurAllBut"
                                            [fields]="field.children"></ige-main-form-tabs>
                    </div>
                </ng-container>

                <!-- only nest fields visually but not in json -->
                <ng-container *ngIf="!field.key">

                    <!-- render nested rubric -->
                    <ng-container *ngIf="field.controlType === 'rubric' && currentCategory === field.label">
                        <div class="{{field.domClass}}">
                            <ige-main-form-tabs [form]="form"
                                                [isRootLevel]="false"
                                                [blurAllBut]="blurAllBut"
                                                [fields]="field.children"></ige-main-form-tabs>
                                                <!--style="overflow: auto;"-->
                        </div>
                    </ng-container>
                    <ng-container *ngIf="field.controlType !== 'rubric'">
                        <div class="{{field.domClass}}">
                            <ige-main-form-tabs [form]="form"
                                                [isRootLevel]="false"
                                                [blurAllBut]="blurAllBut"
                                                [fields]="field.children"></ige-main-form-tabs>
                        </div>
                    </ng-container>
                </ng-container>

            </ng-container>

            <!-- REPEATABLE FIELDS -->
            <ng-container *ngIf="field.isRepeatable">
                <div [formArrayName]="field.key" class="full">
                    <!-- render data -->
                    <mat-expansion-panel *ngFor="let child of field.children; let i=index">

                        <!-- Header of partial -->
                        <mat-expansion-panel-header *ngIf="child.children">
                            <mat-panel-title>{{i+1}}. {{child.label}}</mat-panel-title>
                            <mat-panel-description>
                                <button mat-icon-button
                                        (click)="removeArrayGroup(field.key, i)">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </mat-panel-description>
                        </mat-expansion-panel-header>

                        <!-- render all partial fields -->
                        <div [formGroupName]="i"
                             [class.d-none]="!expandedField[child.key + i]">
                            <div class="{{child.domClass}}">
                                <ige-main-form-tabs [form]="form.controls[field.key].controls[i].controls[child.key]"
                                                    [blurAllBut]="blurAllBut"
                                                    [fields]="child.children"></ige-main-form-tabs>
                            </div>
                        </div>
                        <div style="clear: both;"></div>
                    </mat-expansion-panel>

                    <!-- render generator field to add new partial -->
                    <partial-generator [field]="field"
                                       [form]="form"
                                       (onAddSection)="addSection($event)"></partial-generator>

                </div>
            </ng-container>
        </ng-container>
        <!--</div>-->
    </ng-container>
</ng-container>
